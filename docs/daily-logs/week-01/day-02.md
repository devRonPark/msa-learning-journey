# Day 2 - MSA ì¥ë‹¨ì  ë° ë„ì… ì‹œì  ë¶„ì„

> **í•™ìŠµ ê¸°ê°„**: 2025ë…„ 06ì›” 02ì¼ (ì›”ìš”ì¼)  
> **í•™ìŠµ ì‹œê°„**: 2ì‹œê°„  
> **ì™„ë£Œìœ¨**: 2/60ì¼ (3.3%)

## ğŸ¯ ì˜¤ëŠ˜ì˜ í•™ìŠµ ëª©í‘œ

- [x] MSA ë„ì…ì˜ ì¥ì ê³¼ ë‹¨ì ì„ êµ¬ì²´ì  ì‚¬ë¡€ì™€ í•¨ê»˜ ì •ë¦¬
- [x] ì–¸ì œ MSAë¥¼ ë„ì…í•´ì•¼ í•˜ê³ , ì–¸ì œëŠ” í”¼í•´ì•¼ í•˜ëŠ”ì§€ íŒë‹¨ ê¸°ì¤€ í•™ìŠµ
- [x] ì‹¤ì œ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ í†µí•œ MSA ë¬¸ì œ í•´ê²° ëŠ¥ë ¥ ë°°ì–‘

## ğŸ“š í•™ìŠµ ë‚´ìš©

### ì£¼ìš” ê°œë…

**1. MSAì˜ 5ê°€ì§€ í•µì‹¬ íŠ¹ì§•**

- ë…ë¦½ì  ë°°í¬ ê°€ëŠ¥
- ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸ ì¤‘ì‹¬ ì„¤ê³„
- API ê¸°ë°˜ í†µì‹ 
- ë¶„ì‚° ë°ì´í„° ê´€ë¦¬
- ê¸°ìˆ  ìŠ¤íƒì˜ ììœ 

**2. MSAì˜ ì£¼ìš” ì¥ì **

- **ë…ë¦½ì  í™•ì¥ì„±**: í•„ìš”í•œ ì„œë¹„ìŠ¤ë§Œ ì„ íƒì ìœ¼ë¡œ ìŠ¤ì¼€ì¼ë§
- **ê¸°ìˆ  ìŠ¤íƒ ë‹¤ì–‘ì„±**: ì„œë¹„ìŠ¤ë³„ ìµœì  ê¸°ìˆ  ì„ íƒ (Java-ì•ˆì •ì„±, Node.js-ì†ë„, Python-ML)
- **ì¥ì•  ê²©ë¦¬**: Netflix ì‚¬ë¡€ - ì¶”ì²œ ì„œë¹„ìŠ¤ ë‹¤ìš´ë˜ì–´ë„ ìŠ¤íŠ¸ë¦¬ë° ì„œë¹„ìŠ¤ëŠ” ì •ìƒ ìš´ì˜
- **ê°œë°œíŒ€ ììœ¨ì„±**: Amazon Two-Pizza Rule (6-8ëª… íŒ€, ì„œë¹„ìŠ¤ë³„ ì™„ì „í•œ ì†Œìœ ê¶Œ)
- **ë¹ ë¥¸ ë°°í¬**: NetflixëŠ” í•˜ë£¨ ìˆ˜ì²œ ë²ˆ ë…ë¦½ì  ë°°í¬

**3. MSAì˜ ì£¼ìš” ë‹¨ì **

- **ë³µì¡ì„± í­ì¦**: ì„œë¹„ìŠ¤ ê°„ í†µì‹  ê´€ë¦¬, ë¶„ì‚° íŠ¸ëœì­ì…˜ ì²˜ë¦¬, ì„œë¹„ìŠ¤ ë°œê²¬ê³¼ ë¼ìš°íŒ…
- **ë„¤íŠ¸ì›Œí¬ ì§€ì—°**: ëª¨ë†€ë¦¬ì‹ ë©”ì†Œë“œ í˜¸ì¶œ(<1ms) vs MSA HTTP í˜¸ì¶œ(10-100ms)
- **ë°ì´í„° ì¼ê´€ì„± ë¬¸ì œ**: ë¶„ì‚° íŠ¸ëœì­ì…˜ì—ì„œì˜ ë¶€ë¶„ ì‹¤íŒ¨ ì²˜ë¦¬
- **ìš´ì˜ ì˜¤ë²„í—¤ë“œ**: ì„œë¹„ìŠ¤ë³„ ëª¨ë‹ˆí„°ë§, ë¡œê·¸ í†µí•© ê´€ë¦¬, ë°°í¬ íŒŒì´í”„ë¼ì¸ ë³µì¡í™”
- **í…ŒìŠ¤íŒ… ë³µì¡ì„±**: í†µí•© í…ŒìŠ¤íŠ¸ í™˜ê²½ êµ¬ì¶•, ì„œë¹„ìŠ¤ ëª¨í‚¹ í•„ìš”

**4. MSA ë„ì… ì˜ì‚¬ê²°ì • ê¸°ì¤€**

**ë„ì… ì¶”ì²œ ì¡°ê±´:**

- ê°œë°œíŒ€ 15ëª… ì´ìƒ
- ì„œë¹„ìŠ¤ë³„ í™•ì¥ ìš”êµ¬ì‚¬í•­ ìƒì´
- ëª…í™•í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸ ê²½ê³„
- ì¶©ë¶„í•œ DevOps ì—­ëŸ‰

**ëª¨ë†€ë¦¬ì‹ ìœ ì§€ ì¶”ì²œ ì¡°ê±´:**

- íŒ€ ê·œëª¨ 10ëª… ì´í•˜
- MVP/í”„ë¡œí† íƒ€ì… ë‹¨ê³„
- ë¶ˆë¶„ëª…í•œ ë„ë©”ì¸ ê²½ê³„
- DevOps ì—­ëŸ‰ ë¶€ì¡±

**5. Martin Fowlerì˜ "Monolith First" ì›ì¹™**

- ì‘ê²Œ ì‹œì‘í•´ì„œ ê²½ê³„ë¥¼ ì°¾ì•„ë¼
- ë„ë©”ì¸ ì´í•´ í›„ ë¶„í•´í•˜ë¼
- Strangler Fig Patternì„ í†µí•œ ì ì§„ì  ì „í™˜

### ì‹¤ìŠµ ë‚´ìš©

**ì‹¤ìŠµ 1: Black Friday íŠ¸ë˜í”½ ë¶„ì„**

- ì„œë¹„ìŠ¤ë³„ íŠ¸ë˜í”½ ì¦ê°€ìœ¨ ë¶„ì„: ê²°ì œ(22.5ë°°) > ì£¼ë¬¸(20ë°°) > ìƒí’ˆì¡°íšŒ(10ë°°) > ì‚¬ìš©ìë“±ë¡(1.6ë°°)
- **í•µì‹¬ ê¹¨ë‹¬ìŒ**: ê²°ì œ ì„œë¹„ìŠ¤ íŠ¸ë˜í”½ì´ ê°€ì¥ í¬ì§€ë§Œ, ì£¼ë¬¸ ì²˜ë¦¬ ì„œë¹„ìŠ¤ë¥¼ ìš°ì„  í™•ì¥í•´ì•¼ í•¨
- **ì´ìœ **: ê²°ì œëŠ” ì£¼ë¬¸ ì™„ë£Œ í›„ì—ë§Œ ì‹¤í–‰ë˜ë¯€ë¡œ, ìƒë¥˜ ì„œë¹„ìŠ¤ì¸ ì£¼ë¬¸ ì²˜ë¦¬ê°€ ë³‘ëª©ì´ ë˜ë©´ ê²°ì œê¹Œì§€ ë„ë‹¬í•˜ì§€ ëª»í•¨

**ì‹¤ìŠµ 2: ë¶„ì‚° íŠ¸ëœì­ì…˜ ë¬¸ì œ í•´ê²° (Saga íŒ¨í„´)**

- ì‹œë‚˜ë¦¬ì˜¤: ê²Œì„ ì•„ì´í…œ êµ¬ë§¤ (í¬ì¸íŠ¸ ì°¨ê° â†’ ì•„ì´í…œ ì¶”ê°€ â†’ êµ¬ë§¤ ê¸°ë¡)
- ë¬¸ì œ ìƒí™©: 2ë‹¨ê³„(ì•„ì´í…œ ì¶”ê°€)ì—ì„œ ì„œë²„ ì˜¤ë¥˜ ë°œìƒ
- **í•´ê²° ë°©ì•ˆ**: Saga íŒ¨í„´ì˜ ë³´ìƒ íŠ¸ëœì­ì…˜ìœ¼ë¡œ í¬ì¸íŠ¸ ì°¨ê°ì„ ë¡¤ë°±

**ì‹¤ìŠµ 3: MSA ë„ì… ì˜ì‚¬ê²°ì •**

- íšŒì‚¬ ìƒí™©: ê°œë°œíŒ€ 25ëª…, MAU 100ë§Œ, ì†Œì…œë¯¸ë””ì–´ í”Œë«í¼, DevOpsíŒ€ 3ëª…
- **ê²°ë¡ **: MSA ë„ì… ì¶”ì²œ
- **ê·¼ê±°**: ë°°í¬ ì¤‘ë‹¨ ë¬¸ì œ í•´ê²°, ë…ë¦½ì  í™•ì¥ ê°€ëŠ¥, ì¶©ë¶„í•œ ì¸ë ¥ê³¼ DevOps ì—­ëŸ‰

### ì½”ë“œ ìŠ¤ë‹ˆí«

```java
// ì˜¨ë¼ì¸ ê²Œì„ ì•„ì´í…œ êµ¬ë§¤ Saga íŒ¨í„´ êµ¬í˜„
@Service
public class ItemPurchaseSagaService {

    @Autowired
    private AccountService accountService;

    @Autowired
    private InventoryService inventoryService;

    @Autowired
    private OrderService orderService;

    // Saga ì§„í–‰ ìƒí™©ì„ ì €ì¥í•  ì €ì¥ì†Œ
    private Map<String, ItemPurchaseSaga> sagaStorage = new ConcurrentHashMap<>();

    /**
     * ì•„ì´í…œ êµ¬ë§¤ Saga ì‹œì‘
     */
    public String startPurchase(Long userId, String itemId, int price) {
        // 1. Saga ê°ì²´ ìƒì„±
        String sagaId = UUID.randomUUID().toString();
        ItemPurchaseSaga saga = new ItemPurchaseSaga(sagaId, userId, itemId, price);
        sagaStorage.put(sagaId, saga);

        System.out.println("ğŸš€ Saga ì‹œì‘: " + sagaId);

        // 2. ì²« ë²ˆì§¸ ë‹¨ê³„ ì‹¤í–‰
        executeStep1_DeductMoney(saga);

        return sagaId;
    }

    /**
     * 1ë‹¨ê³„: ê²Œì„ë¨¸ë‹ˆ ì°¨ê°
     */
    private void executeStep1_DeductMoney(ItemPurchaseSaga saga) {
        System.out.println("ğŸ’° 1ë‹¨ê³„: ê²Œì„ë¨¸ë‹ˆ ì°¨ê° ì‹œë„...");

        try {
            MoneyDeductResult result = accountService.deductMoney(
                saga.getUserId(), saga.getPrice()
            );

            if (result.isSuccess()) {
                saga.setMoneyDeducted(true);
                saga.setMoneyTransactionId(result.getTransactionId());

                System.out.println("âœ… 1ë‹¨ê³„ ì„±ê³µ: " + saga.getPrice() + "ì› ì°¨ê° ì™„ë£Œ");
                executeStep2_AddItem(saga);  // ë‹¤ìŒ ë‹¨ê³„ ì‹¤í–‰

            } else {
                System.out.println("âŒ 1ë‹¨ê³„ ì‹¤íŒ¨: " + result.getErrorMessage());
                completeSaga(saga, "FAILED_INSUFFICIENT_MONEY");
            }

        } catch (Exception e) {
            System.out.println("ğŸ’€ 1ë‹¨ê³„ ì˜ˆì™¸ ë°œìƒ: " + e.getMessage());
            completeSaga(saga, "FAILED_MONEY_SERVICE_ERROR");
        }
    }

    /**
     * 2ë‹¨ê³„: ì•„ì´í…œ ì§€ê¸‰
     */
    private void executeStep2_AddItem(ItemPurchaseSaga saga) {
        System.out.println("ğŸ’ 2ë‹¨ê³„: ì•„ì´í…œ ì§€ê¸‰ ì‹œë„...");

        try {
            ItemAddResult result = inventoryService.addItem(
                saga.getUserId(), saga.getItemId()
            );

            if (result.isSuccess()) {
                saga.setItemAdded(true);
                saga.setItemTransactionId(result.getTransactionId());

                System.out.println("âœ… 2ë‹¨ê³„ ì„±ê³µ: " + saga.getItemId() + " ì§€ê¸‰ ì™„ë£Œ");
                executeStep3_RecordPurchase(saga);  // ë‹¤ìŒ ë‹¨ê³„ ì‹¤í–‰

            } else {
                System.out.println("âŒ 2ë‹¨ê³„ ì‹¤íŒ¨: " + result.getErrorMessage());
                System.out.println("ğŸ”„ 1ë‹¨ê³„ ë¡¤ë°± ì‹œì‘...");
                compensateStep1_RefundMoney(saga);  // ë³´ìƒ íŠ¸ëœì­ì…˜ ì‹¤í–‰
            }

        } catch (Exception e) {
            System.out.println("ğŸ’€ 2ë‹¨ê³„ ì˜ˆì™¸ ë°œìƒ: " + e.getMessage());
            System.out.println("ğŸ”„ 1ë‹¨ê³„ ë¡¤ë°± ì‹œì‘...");
            compensateStep1_RefundMoney(saga);
        }
    }

    /**
     * ë³´ìƒ íŠ¸ëœì­ì…˜: ê²Œì„ë¨¸ë‹ˆ í™˜ë¶ˆ
     */
    private void compensateStep1_RefundMoney(ItemPurchaseSaga saga) {
        System.out.println("ğŸ’¸ ë³´ìƒ íŠ¸ëœì­ì…˜: ê²Œì„ë¨¸ë‹ˆ í™˜ë¶ˆ ì‹œë„...");

        if (!saga.isMoneyDeducted()) {
            System.out.println("âš ï¸ ëˆ ì°¨ê°ì´ ì•ˆë˜ì–´ ìˆì–´ì„œ í™˜ë¶ˆí•  í•„ìš” ì—†ìŒ");
            completeSaga(saga, "COMPENSATION_COMPLETED");
            return;
        }

        try {
            RefundResult result = accountService.refundMoney(
                saga.getUserId(),
                saga.getPrice(),
                saga.getMoneyTransactionId()  // ì›ë˜ ê±°ë˜ IDë¡œ í™˜ë¶ˆ
            );

            if (result.isSuccess()) {
                saga.setMoneyDeducted(false);  // ë¡¤ë°± ì™„ë£Œ í‘œì‹œ
                System.out.println("âœ… ë³´ìƒ íŠ¸ëœì­ì…˜ ì„±ê³µ: " + saga.getPrice() + "ì› í™˜ë¶ˆ ì™„ë£Œ");
                completeSaga(saga, "COMPENSATION_COMPLETED");

            } else {
                System.out.println("âŒ ë³´ìƒ íŠ¸ëœì­ì…˜ ì‹¤íŒ¨: " + result.getErrorMessage());
                System.out.println("ğŸš¨ ìˆ˜ë™ ì²˜ë¦¬ í•„ìš”! ì‚¬ìš©ìì—ê²Œ " + saga.getPrice() + "ì› í™˜ë¶ˆ ìš”ë§");
                completeSaga(saga, "COMPENSATION_FAILED");
            }

        } catch (Exception e) {
            System.out.println("ğŸ’€ ë³´ìƒ íŠ¸ëœì­ì…˜ ì˜ˆì™¸: " + e.getMessage());
            System.out.println("ğŸš¨ ê¸´ê¸‰! ìˆ˜ë™ ì²˜ë¦¬ í•„ìš”!");
            completeSaga(saga, "COMPENSATION_FAILED");
        }
    }
}
```

```java
// Saga ìƒíƒœ ê´€ë¦¬ ê°ì²´
public class ItemPurchaseSaga {
    private String sagaId;              // ì´ êµ¬ë§¤ ê³¼ì •ì˜ ê³ ìœ  ID
    private Long userId;                // êµ¬ë§¤í•˜ëŠ” ì‚¬ìš©ì
    private String itemId;              // êµ¬ë§¤í•  ì•„ì´í…œ
    private int price;                  // ì•„ì´í…œ ê°€ê²©

    // ê° ë‹¨ê³„ì˜ ì™„ë£Œ ìƒíƒœë¥¼ ì¶”ì 
    private boolean moneyDeducted = false;      // ëˆì„ ì°¨ê°í–ˆëŠ”ê°€?
    private boolean itemAdded = false;          // ì•„ì´í…œì„ ì§€ê¸‰í–ˆëŠ”ê°€?
    private boolean purchaseRecorded = false;   // êµ¬ë§¤ë¥¼ ê¸°ë¡í–ˆëŠ”ê°€?

    // ì‹¤íŒ¨ ì‹œ ë¡¤ë°±ì— í•„ìš”í•œ ì •ë³´ë“¤
    private String moneyTransactionId;          // ëˆ ì°¨ê° ê±°ë˜ ID
    private String itemTransactionId;           // ì•„ì´í…œ ì§€ê¸‰ ê±°ë˜ ID
    private String orderTransactionId;          // ì£¼ë¬¸ ê¸°ë¡ ID

    // í˜„ì¬ ì§„í–‰ ìƒí™©ì„ í™•ì¸í•˜ëŠ” ë©”ì†Œë“œ
    public boolean isCompleted() {
        return moneyDeducted && itemAdded && purchaseRecorded;
    }

    public boolean hasFailed() {
        // ì–´ë–¤ ë‹¨ê³„ê°€ ì‹¤í–‰ë˜ì—ˆì§€ë§Œ ì™„ë£Œë˜ì§€ ì•Šì€ ê²½ìš°
        return (moneyDeducted && !itemAdded) ||
               (itemAdded && !purchaseRecorded);
    }

    // ìƒì„±ì, getter, setter...
}
```

## ğŸ’¡ í•µì‹¬ ê¹¨ë‹¬ìŒ

- **MSAëŠ” ë§ŒëŠ¥ì´ ì•„ë‹ˆë‹¤**: ë³µì¡ì„±ì´ í¬ê²Œ ì¦ê°€í•˜ë¯€ë¡œ ì¶©ë¶„í•œ ê·œëª¨ì™€ ì—­ëŸ‰ì´ ìˆì„ ë•Œë§Œ ë„ì…í•´ì•¼ í•¨
- **ì˜ì¡´ì„± ìˆœì„œê°€ ì¤‘ìš”í•˜ë‹¤**: íŠ¸ë˜í”½ ì¦ê°€ìœ¨ë§Œ ë³´ê³  í™•ì¥í•˜ë©´ ì•ˆ ë˜ê³ , ì„œë¹„ìŠ¤ ê°„ ì˜ì¡´ ê´€ê³„ë¥¼ ê³ ë ¤í•´ì•¼ í•¨ (ì£¼ë¬¸ â†’ ê²°ì œ ìˆœì„œ)
- **ë¶„ì‚° í™˜ê²½ì—ì„œëŠ” ë¶€ë¶„ ì‹¤íŒ¨ê°€ í•„ì—°ì ì´ë‹¤**: Saga íŒ¨í„´ ê°™ì€ ë³´ìƒ ë©”ì»¤ë‹ˆì¦˜ì„ ë¯¸ë¦¬ ì„¤ê³„í•´ì•¼ í•¨
- **Saga íŒ¨í„´ì˜ í•µì‹¬**: "í° íŠ¸ëœì­ì…˜ì„ ì‘ì€ ë‹¨ê³„ë“¤ë¡œ ë‚˜ëˆ„ê³ , ì‹¤íŒ¨í•˜ë©´ ì´ë¯¸ í•œ ì¼ë“¤ì„ ë˜ëŒë¦°ë‹¤"
- **ìƒíƒœ ì¶”ì ì˜ ì¤‘ìš”ì„±**: ê° ë‹¨ê³„ì˜ ì™„ë£Œ ì—¬ë¶€ì™€ íŠ¸ëœì­ì…˜ IDë¥¼ ì €ì¥í•´ì•¼ ì •í™•í•œ ë¡¤ë°±ì´ ê°€ëŠ¥í•¨

## ğŸ¤” ì–´ë ¤ì› ë˜ ì 

- **ë¬¸ì œ ìƒí™©**: ë¶„ì‚° íŠ¸ëœì­ì…˜ì—ì„œ ë¶€ë¶„ ì‹¤íŒ¨ ì²˜ë¦¬ ë°©ë²•ì´ ë³µì¡í•¨
- **í•´ê²° ê³¼ì •**: Saga íŒ¨í„´ì˜ ë³´ìƒ íŠ¸ëœì­ì…˜ ê°œë…ì„ ê²Œì„ ì•„ì´í…œ êµ¬ë§¤ ì‹œë‚˜ë¦¬ì˜¤ë¡œ êµ¬ì²´ì ìœ¼ë¡œ ì´í•´
- **í•µì‹¬ í•™ìŠµ**: ëª¨ë†€ë¦¬ì‹ì—ì„œëŠ” `@Transactional` í•˜ë‚˜ë¡œ í•´ê²°ë˜ë˜ ê²ƒì´ MSAì—ì„œëŠ” ê° ë‹¨ê³„ë³„ ì„±ê³µ/ì‹¤íŒ¨ ì²˜ë¦¬ + ë³´ìƒ íŠ¸ëœì­ì…˜ êµ¬í˜„ì´ í•„ìš”í•¨

## ğŸ”— ì°¸ê³  ìë£Œ

- [Martin Fowler - Microservices](https://martinfowler.com/articles/microservices.html)
- [Netflix Technology Blog](https://netflixtechblog.com/)
- [Sam Newman - Building Microservices (ì±…)](https://www.amazon.com/Building-Microservices-Designing-Fine-Grained-Systems/dp/1491950358)
- [Spring Cloud ê³µì‹ ë¬¸ì„œ](https://spring.io/projects/spring-cloud)

## âœ… ëª©í‘œ ë‹¬ì„±ë„

- [x] MSA ì¥ë‹¨ì ì„ ì‹¤ì œ ì‚¬ë¡€(Netflix, Amazon)ì™€ í•¨ê»˜ ì •ë¦¬
- [x] MSA ë„ì… ì˜ì‚¬ê²°ì • ì²´í¬ë¦¬ìŠ¤íŠ¸ í•™ìŠµ ë° ì‹¤ì œ ì¼€ì´ìŠ¤ ë¶„ì„
- [x] Saga íŒ¨í„´ì„ í†µí•œ ë¶„ì‚° íŠ¸ëœì­ì…˜ ë¬¸ì œ í•´ê²° ë°©ë²• ì™„ì „ ì´í•´
- [x] 3ê°€ì§€ ì‹¤ìŠµì„ í†µí•œ MSA ì‹¤ë¬´ ë¬¸ì œ í•´ê²° ëŠ¥ë ¥ ë°°ì–‘

## ğŸ¯ ë‚´ì¼ ê³„íš

**Day 3: DDD ê¸°ì´ˆ ë° ì„œë¹„ìŠ¤ ë¶„í•´ ì „ëµ**

- Domain-Driven Design í•µì‹¬ ê°œë… í•™ìŠµ
- Bounded Contextë¥¼ í†µí•œ ì˜¬ë°”ë¥¸ ì„œë¹„ìŠ¤ ê²½ê³„ ì„¤ì •
- Event Stormingì„ í™œìš©í•œ ë„ë©”ì¸ ëª¨ë¸ë§ ì‹¤ìŠµ
- MSA ì „í™˜ ë¡œë“œë§µ ì‘ì„± ë° ë‹¨ê³„ì  ì ìš© ì „ëµ

---

**ì—°ì† í•™ìŠµì¼**: 1ì¼ ğŸ”¥ğŸ”¥
